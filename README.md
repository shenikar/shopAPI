# Shop API

Это бэкенд-сервис для REST API магазина бытовой техники, написанный на Go. Проект использует чистую архитектуру, PostgreSQL в качестве базы данных и полностью контейнеризирован с помощью Docker.

## Особенности

- **RESTful API** для управления клиентами, товарами, поставщиками и изображениями.
- **Полное покрытие Swagger (OpenAPI)** для интерактивной документации.
- **Контейнеризация** с помощью Docker и Docker Compose для легкого запуска и развертывания.
- **Чистая архитектура** с разделением на слои (handler, service, repository).
- **Автоматические миграции базы данных** при запуске приложения.
- **Валидация** входящих данных.

## Технологический стек

- **Язык:** Go
- **Веб-фреймворк:** Gin
- **База данных:** PostgreSQL
- **Контейнеризация:** Docker, Docker Compose
- **Миграции:** golang-migrate
- **Документация API:** Swag (Swagger)
- **Валидация:** go-playground/validator

## Начало работы

### Требования

- [Docker](https://www.docker.com/get-started)
- [Docker Compose](https://docs.docker.com/compose/install/)

### Установка и запуск

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <git@github.com:shenikar/shopAPI.git>
    cd shopAPI
    ```

2.  **Создайте файл `.env`:**
    Скопируйте файл `.env_example` и назовите его `.env`.
    ```bash
    cp .env_example .env
    ```

3.  **Настройте переменные окружения:**
    Откройте файл `.env` и впишите свои данные для `DB_USER` и `DB_PASSWORD`. Остальные переменные можно оставить по умолчанию.
    ```env
    DB_HOST=localhost
    DB_PORT=5432
    DB_USER=your_user # <--- Впишите сюда имя пользователя
    DB_PASSWORD=your_password # <--- Впишите сюда пароль
    DB_NAME=shop
    DB_SSLMODE=disable
    SERVER_PORT=8080
    MIGRATIONS_PATH=migrations
    ```

4.  **Запустите проект с помощью Docker Compose:**
    Эта команда соберет образ Go-приложения, запустит контейнеры с приложением и базой данных, а также автоматически применит миграции.
    ```bash
    docker-compose up --build
    ```

    После успешного запуска:
    - API будет доступно по адресу `http://localhost:8080`
    - Интерактивная документация Swagger будет доступна по адресу `http://localhost:8080/swagger/index.html`

### Остановка проекта

Чтобы остановить все запущенные контейнеры, выполните:
```bash
docker-compose down
```

Чтобы остановить и удалить том с данными базы данных (полная очистка):
```bash
docker-compose down -v
```

## Документация API

Проект использует Swagger для автоматической генерации интерактивной документации. После запуска приложения перейдите по адресу:

[http://localhost:8080/swagger/index.html](http://localhost:8080/swagger/index.html)

### Обновление документации

Если вы добавляете новые эндпоинты или изменяете существующие, не забудьте добавить или обновить Swagger-аннотации в коде (в слое `handler`). После этого выполните следующую команду для перегенерации файлов документации:

```bash
swag init -g cmd/shopApi/main.go
```

## Структура проекта

```
.
├── cmd/shopApi/main.go     # Точка входа в приложение
├── internal/               # Внутренняя логика приложения
│   ├── config/             # Конфигурация
│   ├── db/                 # Подключение к БД
│   ├── domain/             # Модели домена (DAL) и ошибки
│   ├── dto/                # Объекты передачи данных (DTO)
│   ├── handler/            # Обработчики HTTP-запросов (контроллеры)
│   ├── mapper/             # Мапперы для преобразования DTO <-> DAL
│   ├── repository/         # Слой доступа к данным (репозитории)
│   ├── router/             # Настройка маршрутизации (роутер)
│   └── service/            # Бизнес-логика (сервисы)
├── migrations/             # SQL-файлы миграций БД
├── .env_example            # Пример файла переменных окружения
├── Dockerfile              # Dockerfile для сборки Go-приложения
├── docker-compose.yml      # Файл Docker Compose для запуска проекта
└── README.md               # Этот файл

## Postman-коллекция

В корне проекта находится файл `postman_collection.json`. Вы можете импортировать его в Postman, чтобы получить готовую коллекцию запросов для тестирования API.

### Настройка окружения

В коллекции используется переменная `{{base_url}}` со значением по умолчанию `http://localhost:8080`. Если ваше приложение запущено на другом порту, измените значение этой переменной в настройках окружения Postman.

### Как тестировать API

**Важно:** Некоторые запросы зависят от данных, созданных другими запросами. Например, чтобы создать продукт, сначала нужно создать поставщика.

#### Пример последовательности тестирования:

1.  **Создайте поставщика:**
    *   Перейдите в папку "Suppliers" и выполните запрос "Create Supplier".
    *   Скопируйте `id` из тела ответа.

2.  **Создайте продукт:**
    *   Перейдите в папку "Products" и откройте запрос "Create Product".
    *   В теле запроса вставьте скопированный `id` поставщика в поле `supplier_id`.
    *   Выполните запрос.

3.  **Создайте изображение:**
    *   Скопируйте `id` только что созданного продукта.
    *   Перейдите в папку "Images" и откройте запрос "Add Image".
    *   В теле запроса вставьте `id` продукта в поле `product_id`.
    *   Выполните запрос.

Следуя этому порядку, вы обеспечите необходимые внешние ключи для ваших запросов и избежите ошибок.

### Тестирование загрузки изображений

При тестировании эндпоинта `POST /api/v1/images`, обратите внимание на следующие моменты:

1.  **`product_id`**: Убедитесь, что вы используете `id` реально существующего продукта.
2.  **`image`**: Это поле должно содержать **строку в формате Base64**, а не просто текст.

**Как получить строку Base64:**

*   Возьмите любой файл изображения (например, `my_image.png`).
*   Используйте онлайн-конвертер (поищите "image to base64") или утилиту командной строки для преобразования файла в строку Base64.

**Пример тела запроса в Postman:**

Ниже приведен пример с реальными, но очень маленькими данными (1x1 красный пиксель в формате GIF), чтобы вы могли протестировать запрос.

```json
{
    "product_id": "здесь-должен-быть-id-вашего-продукта",
    "image": "R0lGODlhAQABAIABAP8AAAAAACwAAAAAAQABAAACAkQBADs="
}
```